<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta charset="utf-8" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<title>模型设计</title>
	</head>
<body>
<h1>模型设计</h1>

<blockquote>
<p>数据仓库中有几种经典的数据模型：范式模型、维度模型、DataVault。很多模型的设计都在同构化，而且在工作中也不是单独地用一种模型，会根据业务场景作出各种取舍。</p>
</blockquote>

<p>有了适合业务和基础数据存储环境的模型，那么大数据就能获得以下好处：</p>

<ol>
	<li>性能

		<p>良好的数据模型能帮助我们快速查询所需要的数据，减少数据的I/O吞吐</p></li>
	<li>成本

		<p>良好的数据模型能极大地减少不必要的数据冗余，也能实现计算结果复用，极大地降低大数据系统中的存储和计算成本</p></li>
	<li>效率

		<p>良好的数据模型能极大地改善用户使用数据的体验，提高使用数据的效率</p></li>
	<li>质量

		<p>良好的数据模型能改善数据统计口径的不一致性，减少数据计算错误的可能性</p></li>
</ol>

<hr />

<h2>范式模型</h2>

<p><strong>范式</strong>是数据库逻辑模型设计的基本理论，一个关系模型可以从第一范式到第五范式进行无损分解。数据仓库的模型设计中目前一般采用<strong>第三范式</strong>：</p>

<ul>
	<li>数据库表的每一列都是不可分割的基本数据项</li>
	<li>数据库表中的每个实例或行必须可以被唯一地区分</li>
	<li>数据库表中不包含已在其他表中已包含的非关键字信息</li>
</ul>

<p>数据仓库中的3NF与OLTP系统中的3NF的区别在于<strong>站在企业角度面向主题的抽象</strong>，而不是针对某个具体业务流程的实体对象关系抽象，它更多的是面向数据的整合和一致性治理。</p>

<p><strong>3NF主要是为了消除冗余。规范化的3NF将数据划分为多个不同的实体，每个实体构成一个关系表。</strong></p>

<hr />

<h2>维度模型</h2>

<p>维度建模从分析决策的需求出发构建模型，为分析需求服务，因此关注点在用户如何更快速地完成需求分析，同时具有较好的大规模复杂查询的响应性能。</p>

<p>维度模型的典型代表是<strong>星型模型</strong>，在进行维度建模的时候会建一张事实表，这个事实表就是星型模型的中心，然后会有一堆维度表，这些维度表就是向外发散的星星。</p>

<p>维度模型里面有两个重要的概念：</p>

<ol>
	<li>事实表：

		<p>发生在现实世界中的操作型事件，其所产生的可度量值，每个事件的具体要素，以及具体发生的事情，存储在事实表中。从最低的粒度级别来看，事实表每一行对应一个度量事件，反之亦然。</p></li>
	<li>维度表：

		<p>是对事实表中事件的要素的描述信息。它保存了维度的属性值，可以跟事实表做关联；相当于将事实表上经常重复出现的属性抽取出来用一张表进行管理。维度表通常比较宽，是扁平型非规范表，包含大量的低粒度的文本属性。</p></li>
</ol>

<h3>维度建模的设计可以分为以下几个步骤</h3>

<ol>
	<li>选择需要进行分析决策的业务过程

		<p>业务过程可以是单个业务事件，也可以是某个事件的状态，或者是一系列相关业务事件组成的业务流程</p></li>
	<li>选择粒度

		<p>在事件分析中，要预判所有分析需要细分的程度，从而决定选择的粒度。粒度是维度的一个组合。</p></li>
	<li>识别维表

		<p>选择好粒度之后，就需要基于此粒度设计维表，包括维度属性，用于分析时进行分组和筛选</p></li>
	<li>选择事实

		<p>确定分析需要衡量的指标</p></li>
</ol>

<h3>模型实施过程</h3>

<blockquote>
<p>构建维度模型一般要经历三个阶段：第一个阶段是高层设计时期，定义业务过程维度模型的范围，提供每种星型模型的技术和功能描述；第二个阶段是详细模型设计时期，对每个星型模型添加属性和度量信息；第三个阶段是进行模型的审查、再设计和验证等工作；第四个阶段是产生详细设计文档，提交ETL设计和开发</p>
</blockquote>

<ol>
	<li>高层模型

		<p>高层模型设计阶段的直接产出目标是创建高层维度模型图，它是对业务过程中的维表和事实表的图形描述。确定维表创建初始属性列表，为每个事实表创建提议度量。</p></li>
	<li>详细模型

		<p>详细的维度建模过程是为高层模型填补缺失的信息，解决设计问题，并不断测试模型能否满足业务需求，确保模型的完备性。确定每个维表的属性和每个事实表的度量，并确定信息来源的位置、定于，确定属性和度量如何填入模型的初步业务规则。</p></li>
	<li>模型审查、再设计和验证

		<p>本阶段主要召集相关人员进行模型的审查和验证，根据审查结果对详细维度进行再设计。</p></li>
	<li>提交ETL设计和开发

		<p>最后，完成模型详细设计文档，提交ETL开发人员，进入ETL设计和开发阶段，由ETL人员完成物理模型的设计和开发。</p></li>
</ol>

<hr />

<h2>阿里实践</h2>

<h3>指导方针</h3>

<p>在建设数据仓库时，首先要进行充分的业务调研和需求分析。</p>

<p>其次，进行数据总体架构设计，主要是根据数据域对数据进行划分；按照维度建模理论，构建总线矩阵、抽象出业务过程和维度。</p>

<p>再次，对报表需求进行抽象整理出相关指标体系，完成指标规范定义和模型设计。</p>

<p>最后是代码研发和运维。</p>

<h3>实施工作流</h3>

<figure><img src="/Users/xerxes/note/dataWareHouse/src/%E5%AE%9E%E6%96%BD%E5%B7%A5%E4%BD%9C%E6%B5%81.png"/></figure>

<ol>
	<li>数据调研

		<ul>
			<li>业务调研：需要对业务系统的业务进行了解</li>
			<li>需求调研：手机数据使用者的需求</li>
		</ul></li>
	<li>架构设计

		<ul>
			<li>数据域划分

				<p>数据域是指面向业务分析，将业务过程或者维度进行抽象的集合。业务过程可以概括为一个个不可拆分的行为事件，如下单、支付、退款。</p>

				<p>数据域需要抽象提炼，并且长期维护和更新，但不轻易变动。</p>

				<p>在划分数据域时，既能涵盖当前所有的业务需求，又能在新业务进入时无影响地被包含进已有的数据域中或者扩展新的数据域。</p></li>
			<li>构建总线矩阵

				<p>明确每个数据域下有哪些业务过程；业务过程与哪些维度相关，并定义每个数据域下的业务过程和维度。</p></li>
		</ul></li>
	<li>规范定义

		<p>规范定义主要定义指标体系，包括原子指标、修饰词、时间周期和派生指标</p></li>
	<li>模型设计

		<p>模型设计主要包括维度及属性的规范定义，维表、明细事实表和汇总事实表的模型设计。</p></li>
	<li>实施过程是一个高度迭代和动态的过程，一般采用螺旋式实施方法。在总体架构设计完成后，开始根据数据域进行迭代式模型设计和评审。在架构设计、规范定义和模型设计等模型实施过程中，都会引入评审机制，以确保模型实施过程的正确性。</li>
</ol>

<hr />

<h2>Data Vault</h2>

<p>可以说是范式和维度两种模型的混合，兼容了两种模型的优势。</p>

<p>它强调建立一个可审计的基础数据层，也就是强调数据的历史性、可追溯性和原子性，而不要求对数据进行过度的一致性处理和整合。同时基于主题概念将企业数据进行结构化组织，并引入了更进一步的范式处理来优化模型，以应对源系统变更的扩展性。</p>

<p>Data Vault主要由：Hub（中心表）、Link（链接表）和Satellite（卫星表）三部分组成。</p>

<h3>中心表</h3>

<p>主要存储一些日常的一些业务关键码，比如客户号、流水号等，包括三个要素：</p>

<ol>
	<li>代理键

		<p>这就是一些操作性的组件，包括客户号，流水号等等</p></li>
	<li>装载时间戳

		<p>这里可以理解为ETL进行日加载的时间</p></li>
	<li>数据源

		<p>就是可以追溯到的原系统，比如CRM，ERP等</p></li>
</ol>

<h3>链接表</h3>

<p>是3NF的多对多关系的物理表现形式，它表现的是多个业务键之间的关系。它和范式模型的最大区别是将关系作为一个独立单元抽象出来，可以提升模型的扩展性。主要包含以下特征：</p>

<ul>
	<li>代理键</li>
	<li>代理键之间的映射关系</li>
	<li>装载时间戳</li>
	<li>数据源</li>
</ul>

<h3>卫星表</h3>

<p>业务领域中的其余信息可能随着时间而变化，所以卫星表必须有能力存储新的或者变化的各种粒度的数据，他们将被存储在卫星表内。</p>

<p>卫星表是中心表的详细描述内容，一个中心表会有多个卫星表。它由中心表的代理键、装载时间戳、来源类型、详细的中心表描述信息等组成。</p>

<hr />

<h2>Anchor模型</h2>

<p>Anchor对Data Vault模型做了进一步规范化处理，初衷是设计一个<strong>高度可扩展</strong>的模型，其核心思想是所有的扩展只是添加而不是修改，因此将模型规范到6NF，基本变成了k-v结构化模型。</p>

<hr />

<h2>其他数据模型</h2>

<p>数据模型是抽象描述现实世界的一种工具和方法，是通过抽象的实体及实体之间联系的形式，来表示现实世界中事务的相互关系的一种映射。</p>

<p>在这里，数据模型抽象的是实体和实体之间的关系，通过对实体和实体之间关系的定义和描述，来表达实际的业务中具体的业务关系。</p>

<h3>数据仓库数据模型架构</h3>

<figure><img src="/Users/xerxes/note/dataWareHouse/src/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%E6%9E%B6%E6%9E%84.jpg"/></figure>

<p>数据仓库的数据模型的架构和数据仓库的整体架构是紧密关联在一起的，整个数据仓库的数据模型可以分为大概 5 大部分, 每个部分其实都有其独特的功能。</p>

<ul>
	<li>系统记录域（System of Record）

		<p>这部分是主要的数据仓库业务数据存储区，数据模型在这里保证了数据的一致性。</p></li>
	<li>内部管理域（Housekeeping）

		<p>这部分主要存储数据仓库用于内部管理的元数据，数据模型在这里能够帮助进行统一的元数据的管理。</p></li>
	<li>汇总域（Summary of Area）

		<p>这部分数据来自于系统记录域的汇总，数据模型在这里保证了分析域的主题分析的性能，满足了部分的报表查询。</p></li>
	<li>分析域（Analysis Area）

		<p>这部分数据模型主要用于各个业务部分的具体的主题业务分析。这部分数据模型可以单独存储在相应的数据集市中。</p></li>
	<li>反馈域（Feedback Area）

		<p>可选项，这部分数据模型主要用于相应前端的反馈数据，数据仓库可以视业务的需要设置这一区域。</p></li>
</ul>

<p>通过对整个数据仓库模型的数据区域的划分，我们可以了解到，一个好的数据模型，不仅仅是对业务进行抽象划分，而且对实现技术也进行具体的指导，它应该涵盖了从业务到实现技术的各个部分。</p>

<h3>数据仓库建模四个过程</h3>

<ol>
	<li><em>业务建模</em>，生成业务模型，划分整个单位的业务，一般按照业务部门的划分，进行各个部分之间业务工作的界定，理清各业务部门之间的关系。主要解决业务层面的分解和程序化。</li>
	<li><em>领域建模</em>，生成领域模型，抽取关键业务概念，并将之抽象化。将业务概念分组，按照业务主线聚合类似的分组概念。细化分组概念，理清分组概念内的业务流程并抽象化。理清分组概念之间的关联，形成完整的领域概念模型。</li>
	<li><em>逻辑建模</em>，生成逻辑模型，主要是将领域模型的概念实体以及实体之间的关系进行数据库层次的逻辑化。</li>
	<li><em>物理建模</em>，生成物理模型，主要解决，逻辑模型针对不同平台的物理化以及性能等一些具体的技术问题。</li>
</ol>

<blockquote>
<p>在整个数据仓库的模型的设计和架构中，既涉及到业务知识，也涉及到了具体的技术，我们既需要了解丰富的行业经验，同时，也需要一定的信息技术来帮助我们实现我们的数据模型，最重要的是，我们还需要一个非常适用的方法论，来指导我们自己针对我们的业务进行抽象，处理，生成各个阶段的模型。</p>
</blockquote>

<h3>数据模型建设能够解决的问题</h3>

<ol>
	<li>进行全面的业务梳理，改进业务流程。

		<p>在业务模型建设的阶段，能够帮助我们的企业或者是管理机关对本单位的业务进行全面的梳理。通过业务模型的建设，我们应该能够全面了解该单位的业务架构图和整个业务的运行情况，能够将业务按照特定的规律进行分门别类和程序化，同时，帮助我们进一步的改进业务的流程，提高业务效率，指导我们的业务部门的生产。</p></li>
	<li>建立全方位的数据视角，消灭信息孤岛和数据差异。

		<p>通过数据仓库的模型建设，能够为企业提供一个整体的数据视角，不再是各个部门只是关注自己的数据，而且通过模型的建设，勾勒出了部门之间内在的联系，帮助消灭各个部门之间的信息孤岛的问题，更为重要的是，通过数据模型的建设，能够保证整个企业的数据的一致性，各个部门之间数据的差异将会得到有效解决。</p></li>
	<li>解决业务的变动和数据仓库的灵活性。

		<p>通过数据模型的建设，能够很好的分离出底层技术的实现和上层业务的展现。当上层业务发生变化时，通过数据模型，底层的技术实现可以非常轻松的完成业务的变动，从而达到整个数据仓库系统的灵活性。</p></li>
	<li>帮助数据仓库系统本身的建设。

		<p>通过数据仓库的模型建设，开发人员和业务人员能够很容易的达成系统建设范围的界定，以及长期目标的规划，从而能够使整个项目组明确当前的任务，加快整个系统建设的速度。</p></li>
</ol>

</body>
</html>

