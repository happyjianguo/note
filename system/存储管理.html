<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta charset="utf-8" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<title>存储管理</title>
	</head>
<body>
<h1>存储管理</h1>

<p>计算机存储设备可被粗略分为<strong>内存储器</strong>和<strong>外存储器</strong>。</p>

<p>内存速度快，容量小，不能长期保存数据。外存速度慢，可以持久化存储。</p>

<p>每个计算机系统中的存储设备都被组织成一个存储器层次结构，在这个层次结构中，从上至下，设备访问速度越来越慢、容量越来越大，并且每字节的造价也越来越便宜。</p>

<figure><img src="/Users/xerxes/note/system/src/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%98%E5%82%A8%E8%AE%BE%E5%A4%87.jpg"/></figure>

<p>存储器层次结构的主要思想是一层上的存储器作为低一层存储器的高速缓存。</p>

<hr />

<h2>主存</h2>

<p>主存是一个临时存储设备，在处理器执行程序时，用来存放程序和程序处理的数据。</p>

<p>从物理上来说，主存是由一组动态随机存取存储器（DRAM）芯片组成。</p>

<p>从逻辑上来说，存储器是一个线性的字节数组，每个字节都有其唯一的地址。一般来说，组成程序的每条机器指令都由不同数据的字节构成。</p>

<figure><img src="/Users/xerxes/note/system/src/%E4%B8%BB%E5%AD%98.jpg"/></figure>

<p>从抽象角度看，主存是一系列的存储单元组成的矩阵，每个存储单元存储固定大小的数据，每个存储单元有唯一的地址。</p>

<p>当系统需要读取主存时，将地址信号放到地址总线上传给主存，主存读到地址信号后，解析信号并定位到指定存储单元，然后将存储单元数据放到数据总线上，供其他部件读取。</p>

<hr />

<h2>寄存器与高速缓存</h2>

<p>寄存器文件在层次结构中位于最顶部。</p>

<p>一个典型的寄存器文件只存储几百字节的信息，而主存里可以存放几十亿字节。处理器从寄存器文件读取数据的速度比主存读取几乎要快100倍。</p>

<p>针对这种处理器与主存之间的差异，系统设计者采用了更小、更快的存储设备，即高速缓存存储器（建成高速缓存），作为暂时的集结区域，用来存放处理器近期可能需要的信息。</p>

<figure><img src="/Users/xerxes/note/system/src/%E5%AF%84%E5%AD%98%E5%99%A8%E4%B8%8E%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98.jpg"/></figure>

<p>L1和L2高速缓存是用一种叫做静态随机访问存储器（SRAM）的硬件技术实现的。系统可以获得一个很大的存储器，同时访问速度也很快，原因是利用了高速缓存的局部性原理，即程序具有访问局部区域里的数据和代码的趋势。通过让告诉缓存里存放可能经常访问的数据，大部分的存储器操作能在快速的高速缓存中完成。</p>

<hr />

<h2>磁盘</h2>

<p>磁盘是一个扁平的圆盘，盘面上有许多称为磁道的圆圈，数据就记录在磁道上。</p>

<p>磁盘可以是单片的，也可以是由若干盘片组成的盘组，每一盘片上有两个面。</p>

<figure><img src="/Users/xerxes/note/system/src/%E7%A3%81%E7%9B%98.jpg"/></figure>

<p>当磁盘驱动器执行读/写操作时，盘片装在一个主轴上，并绕主轴高速旋转，当磁道在读/写头（又叫磁头）下通过时，就可以进行数据的读/写。</p>

<p>一般磁盘分为固定头盘和活动头盘。固定头盘的每一个磁道上都有独立的磁头，它是固定不动的，专门负责这一磁道上数据的读/写；活动头盘的磁头是可以移动的，每一个盘面上只有一个磁头（磁头是双向的，因此正反盘面都能读/写），它可以从该面的一个磁道移动到另一个磁道。所有磁头都装在同一个动臂上，因此不同盘面上的所有磁头都是同时移动的。当盘片绕主轴旋转的时候，磁头与旋转的盘片形成一个圆柱体。各个盘面上半径相同的磁道组成一个圆柱面，称为柱面。</p>

<p>磁盘上数据必须用一个三维地址唯一表示：柱面号、盘面号、块号（磁道上的盘块）。</p>

<h3>页、磁盘块与扇区</h3>

<h4>页</h4>

<p>内存的最小存储单位</p>

<h4>磁盘块</h4>

<p>文件系统读写数据的最小单位</p>

<h4>扇区</h4>

<p>磁盘的最小存储单位</p>

<h4>关系</h4>

<p>一个磁盘块由连续几个（2^n）扇区组成。</p>

<p>页的大小为磁盘块大小的2^n倍</p>

<h3>读/写磁盘上某一指定数据的流程</h3>

<ol>
	<li>首先移动臂根据柱面号使磁头移动到所需要的柱面上，这一过程称为定位或查找</li>
	<li>根据盘面号确定指定盘面上的磁道</li>
	<li>盘面确定后，盘片开始旋转，将指定块号的磁道段移动至磁头下</li>
</ol>

<h3>访问某一信息的时间由三部分组成</h3>

<ul>
	<li>查找时间Ts：完成步骤1的时间</li>
	<li>等待时间TI：完成步骤3所需要的时间</li>
	<li>传输时间Tt：数据通过系统总线传送到内存的时间</li>
</ul>

<p>磁盘读取数据是以盘块（block）为基本单位的。位于同一盘块中的所有数据都能被一次性全部读取出来。</p>

<p>而磁盘IO代价主要花费在查找时间Ts上。因此尽量将相关信息存放在同一盘块同一磁道中。</p>

<h3>随机和顺序</h3>

<p><strong>顺序I/O</strong>是指本次I/O给出的初始扇区地址和上一次I/O的结束扇区地址是完全连续或者相隔不多的。反之如果相差很大，则算作一次<strong>随机I/O</strong>。</p>

<p>发生随机I/O可能是因为磁盘碎片导致磁盘空间不连续，或者当前文件大小 大于block空间导致的。</p>

<p>连续I/O比随机I/O效率高的原因是：做连续I/O时磁头几乎不用换道，或者换道时间很短；而随机I/O会需要磁头不停地换道。</p>

</body>
</html>

