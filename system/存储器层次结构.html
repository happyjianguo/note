<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta charset="utf-8" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<title>存储器层次结构</title>
	</head>
<body>
<h1>存储器层次结构</h1>

<p>存储器系统是一个具有不同容量、成本和访问时间的存储设备的层次结构。</p>

<hr />

<h2>存储技术</h2>

<h3>随机访问存储器（Random-Access Memory，RAM）</h3>

<p>RAM 分为两类：静态的和动态的。</p>

<p>静态RAM（SRAM）比动态RAM（DRAM）更快，更贵。</p>

<p>SRAM 用来作为高速缓存存储器，既可以在CPU 芯片上，也可以在芯片下。</p>

<p>DRAM 用来作为主存以及图形系统的帧缓冲区。</p>

<h4>SRAM</h4>

<p>SRAM 将每个位存储在一个双稳态的（bistable）存储器单元里。</p>

<p>每个单元是用一个六晶体管电路来实现的。这个电路有这样一个属性，它可以无限期地保持在两个不同的电压配置（configuration）或状态（state）之一。其他任何状态都是不稳定的。从不稳定状态开始，电路会迅速地转移到两个稳定状态中的一个。</p>

<h4>DRAM</h4>

<p>DRAM 将每个位存储为对一个电容的充电。</p>

<p>这个电容非常小，通常只有大约30毫微微法拉。DRAM 存储器可以制造的非常密集，每个单元由一个电容和一个访问晶体管组成。但是，与SRAM 不同，DRAM 存储器单元对干扰非常敏感。</p>

<h3>磁盘存储</h3>

<h4>磁盘构造</h4>

<p>磁盘由一个或多个叠放在一起的<strong>盘片</strong>组成。每个盘片有两个表面，<strong>表面覆盖着磁性记录材料</strong>。每个表面是由一组称为<strong>磁道（track）</strong>的同心圆组成的，每个磁道被分为一组<strong>扇区（sector）</strong>，数据编码在扇区上的磁性材料中。</p>

<p>每个扇区一般有可存放512字节的<em>数据区</em>，数据区前有用于在读写之前对磁头进行同步的<em>前导区</em>，数据区之后是<em>纠错码</em>，连续的两个扇区之间是<em>隔离带</em>，隔离带不存储数据位，存储用来标示扇区的格式化位。</p>

<figure><img src="/Users/xerxes/note/system/src/%E7%A3%81%E7%9B%98%E7%9B%98%E7%89%87%E7%9A%84%E8%A7%86%E5%9B%BE.png"/></figure>

<figure><img src="/Users/xerxes/note/system/src/%E7%A3%81%E9%81%93%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86.png"/></figure>

<p>盘片中央有一个可以旋转的<strong>主轴</strong>，它使得盘片以固定的旋转速率旋转。磁盘通常包含一个或多个这样的盘片，并封装在一个密封的容器内。整个装置通常称为<strong>磁盘驱动器（disk drive）</strong>，简称为磁盘。</p>

<figure><img src="/Users/xerxes/note/system/src/%E7%A3%81%E7%9B%98%E5%A4%9A%E4%B8%AA%E7%9B%98%E7%89%87%E7%9A%84%E8%A7%86%E5%9B%BE.png"/></figure>

<p><strong>柱面</strong>是所有盘片表面上到主轴中心的距离相等的磁道的集合。</p>

<h4>磁盘容量</h4>

<p>一个磁盘上可以记录的最大位数称为它的<strong>容量</strong>，磁盘容量由以下技术因素决定：</p>

<ul>
	<li>记录密度：磁道一英寸的段中可以放入的位数；</li>
	<li>磁道密度：从盘片中心出发半径上一英寸的段内可以有的磁道数；</li>
	<li>面密度：记录密度与磁道密度的乘积</li>
</ul>

<p>现代大容量磁盘使用一种称为<strong>多区记录（multiple zone recording）</strong>的技术，柱面的集合被分割成不相交的子集合，称为<strong>记录区</strong>。每个区包含一组连续的柱面。一个区中的每个柱面中的每条磁道都有相同数量的扇区，这个扇区的数量是由该区中最里面的磁道所能包含的扇区数确定的。</p>

<h4>磁盘操作</h4>

<p>磁盘用<strong>读/写头</strong>来读写存储在磁性表面的位，而读写头连接到一个<strong>传动臂</strong>一端。通过沿着半径轴前后移动这个传动臂，驱动器可以将读/写头定位在盘面上的任何磁道上。这样的机械运动称为<strong>寻道（seek）</strong>。</p>

<p>一旦读/写头定位到了期望的磁道上，那么当磁道上的每个位通过它的下面时，读/写头可以感知到这个位的值，也可以修改这个位的值。</p>

<p>有多个盘片的磁盘针对每个盘面都有一个独立的读/写头。读/写头垂直排列，所有读/写头都位于同一个柱面上。</p>

<figure><img src="/Users/xerxes/note/system/src/%E7%A3%81%E7%9B%98%E7%9A%84%E5%8A%A8%E6%80%81%E7%89%B9%E6%80%A7.png"/></figure>

<p>磁盘以扇区大小的块来读写数据，对扇区的访问时间有三个主要部分：</p>

<ul>
	<li>寻道时间：为了读取某个扇区的内容，传动臂首先将读/写头定位到包含扇区的磁道上，移动传动臂所需的时间称为寻道时间；</li>
	<li>旋转时间：一旦读/写头定位到了期望的磁道，驱动器等待目标扇区的第一个位旋转到读/写头下；</li>
	<li>传送时间：当目标扇区的第一个位到达读/写头下时，驱动器就可以开始读写该扇区的内容了。一个扇区的传送时间依赖于旋转速度和每条磁道的扇区数目</li>
</ul>

<h4>逻辑磁盘块</h4>

<p>为了对操作系统隐藏磁盘的复杂性，现代磁盘将它们的构造呈现为一个简单的视图：一个B 个扇区大小的<strong>逻辑块</strong>的序列，编号为0、1、…、B-1。磁盘中有一个小的硬件设备，称为<strong>磁盘控制器</strong>，维护着逻辑块号和实际磁盘扇区之间的映射关系。</p>

<p>当操作系统想要执行一个I/O 操作时，操作系统会发送一个命令到磁盘控制器，让它读某个逻辑块号。控制器上的硬件执行一个快速表查找，将一个逻辑块号翻译成一个<strong>（盘面，磁道，扇区）</strong>的三元组，这个三元组唯一标识了对应的物理扇区。</p>

<h4>随机和顺序</h4>

<p><strong>顺序I/O</strong>是指本次I/O给出的初始扇区地址和上一次I/O的结束扇区地址是完全连续或者相隔不多的。反之如果相差很大，则算作一次<strong>随机I/O</strong>。</p>

<p>发生随机I/O可能是因为磁盘碎片导致磁盘空间不连续，或者当前文件大小 大于block空间导致的。</p>

<p>连续I/O比随机I/O效率高的原因是：做连续I/O时磁头几乎不用换道，或者换道时间很短；而随机I/O会需要磁头不停地换道。</p>

<hr />

<h2>局部性</h2>

<p>一个编写良好的计算机程序常常具有良好的<strong>局部性</strong>。</p>

<p>也就是说，它们倾向于引用临近于其他最近引用过的数据项的数据项，或者最近引用过的数据项本身。这种倾向性，称为<strong>局部性原理</strong>。</p>

<p>局部性通常有两种不同的形式：</p>

<ul>
	<li>时间局部性：在一个具有良好的时间局部性的程序中，被引用过一次的存储器位置很可能在不远的将来被再次引用；</li>
	<li>空间局部性：在一个具有良好的空间局部性的程序中，如果一个存储器位置被引用了一次，那么程序很可能在不远的将来引用附近的一个存储器位置</li>
</ul>

<h3>局部性原则</h3>

<ul>
	<li>重复引用同一个变量的程序具有良好的时间局部性；</li>
	<li>对于具有步长为k 的引用模式的程序，步长越小，空间局部性越好；</li>
	<li>对于取指令来说，循环有好的时间和空间局部性。循环体越小，循环迭代次数越多，局部性越好</li>
</ul>

<hr />

<h2>存储器层次结构</h2>

<figure><img src="/Users/xerxes/note/system/src/%E5%AD%98%E5%82%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84.jpg"/></figure>

<p>CPU 寄存器保存着最常用的数据。</p>

<p>靠近CPU 的小的、快速的高速缓存存储器（cache memory）作为一部分存储在相对慢速的主存储器（主存，main memory）中的数据和指令的缓冲区域。</p>

<p>主存暂时存放容量较大的、慢速磁盘上的数据。</p>

<p>而这些磁盘常常又作为存储在通过网络连接的其他机器的磁盘上的数据的缓冲区域。</p>

<p>基于缓存的存储器层次结构行之有效，是因为较慢的存储设备比较快的存储设备更便宜，还因为程序往往展示局部性。</p>

<hr />

<h2>高速缓存存储器</h2>

</body>
</html>

